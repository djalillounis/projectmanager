<form method="get" id="status-filter-form">
    <div class="table-responsive position-relative">
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>Description</th>
            <th>Created Date</th>
            <th>Due Date</th>
            <th class="position-relative">
              Status
              <button type="button" class="btn btn-link btn-sm p-0 ms-2 text-purple" onclick="toggleStatusFilter(this)" title="Filter Status">
                <i class="bi bi-filter"></i>
              </button>
              <div class="floating-status-filter">
                {% for status in status_options %}
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="status" value="{{ status }}"
                         id="status-{{ item_type }}-{{ forloop.counter }}"
                         {% if status in selected_statuses %}checked{% endif %}>
                  <label class="form-check-label" for="status-{{ item_type }}-{{ forloop.counter }}">
                    {{ status }}
                  </label>
                </div>
                {% endfor %}
                <button type="submit" class="btn btn-sm btn-primary mt-2 w-100">Apply</button>
              </div>
            </th>
            <th>Priority</th>
            <th>Next Step Owner</th>
            <th>Last Update</th>
            <th>Last Update Text</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>{{ item.description }}</td>
            <td>{{ item.created_date|date:"Y-m-d" }}</td>
            <td>{{ item.due_date|date:"Y-m-d" }}</td>
            <td>{{ item.status }}</td>
            <td>{{ item.priority }}</td>
            <td>{{ item.next_step_owner }}</td>
            <td>{{ item.last_update|date:"Y-m-d" }}</td>
            <td>{{ item.last_update_text }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" class="text-center text-muted">No items to display.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </form>
  
  <script>
  function toggleStatusFilter(button) {
    const allFilters = document.querySelectorAll('.floating-status-filter');
    allFilters.forEach(f => f.classList.remove('show'));
  
    const filter = button.nextElementSibling;
    filter.classList.toggle('show');
  
    // Close on outside click
    document.addEventListener('click', function handler(e) {
      if (!filter.contains(e.target) && !button.contains(e.target)) {
        filter.classList.remove('show');
        document.removeEventListener('click', handler);
      }
    });
  }
  </script>
  